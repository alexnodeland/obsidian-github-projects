name: Deploy Documentation

on:
  push:
    branches: [main]
    paths:
      - 'docs/**'
      - '.github/workflows/docs.yml'
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Build documentation
        run: |
          # Create docs output directory
          mkdir -p _site

          # Copy documentation files
          cp -r docs/* _site/ || echo "No docs directory yet"

          # Copy README as index if no index exists
          if [ ! -f _site/index.md ] && [ ! -f _site/index.html ]; then
            cp README.md _site/index.md
          fi

          # Create a simple index.html if needed
          if [ ! -f _site/index.html ]; then
            cat > _site/index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="en">
          <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>GitHub Projects for Obsidian - Documentation</title>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
            <style>
              body { padding: 2rem; }
              .container { max-width: 1200px; margin: 0 auto; }
              .hero { text-align: center; padding: 3rem 0; }
              .docs-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin: 2rem 0; }
              .doc-card { padding: 1.5rem; border: 1px solid var(--muted-border-color); border-radius: 8px; }
              .doc-card h3 { margin-top: 0; }
              pre { background: var(--code-background-color); padding: 1rem; border-radius: 4px; overflow-x: auto; }
              code { background: var(--code-background-color); padding: 0.2rem 0.4rem; border-radius: 3px; }
            </style>
          </head>
          <body>
            <div class="container">
              <div class="hero">
                <h1>ğŸ“‹ GitHub Projects for Obsidian</h1>
                <p>Manage GitHub Projects V2 with Kanban boards directly in Obsidian</p>
                <p>
                  <a href="https://github.com/alexnodeland/obsidian-github-projects" role="button">View on GitHub</a>
                  <a href="#getting-started" role="button" class="secondary">Get Started</a>
                </p>
              </div>

              <div class="docs-grid">
                <div class="doc-card">
                  <h3>ğŸ“– User Guide</h3>
                  <p>Learn how to install and use the plugin</p>
                  <a href="user-guide.html">Read the guide â†’</a>
                </div>

                <div class="doc-card">
                  <h3>ğŸ› ï¸ Developer Guide</h3>
                  <p>Contributing and development setup</p>
                  <a href="developer-guide.html">Start developing â†’</a>
                </div>

                <div class="doc-card">
                  <h3>ğŸ—ï¸ Architecture</h3>
                  <p>Technical design and architecture decisions</p>
                  <a href="architecture.html">Explore architecture â†’</a>
                </div>

                <div class="doc-card">
                  <h3>ğŸ”Œ API Reference</h3>
                  <p>Plugin API and extension points</p>
                  <a href="api-reference.html">View API docs â†’</a>
                </div>
              </div>

              <section id="getting-started">
                <h2>Quick Start</h2>
                <ol>
                  <li><strong>Install:</strong> Search for "GitHub Projects" in Obsidian Community Plugins</li>
                  <li><strong>Configure:</strong> Add your GitHub Personal Access Token in settings</li>
                  <li><strong>Connect:</strong> Enter your organization name and project number</li>
                  <li><strong>Use:</strong> Click the dashboard icon to open your project board</li>
                </ol>
              </section>

              <section>
                <h2>Features</h2>
                <ul>
                  <li>ğŸ“‹ Interactive Kanban board view of GitHub Projects V2</li>
                  <li>ğŸ”„ Drag & drop items between columns</li>
                  <li>ğŸ” Secure token storage (not synced with vault)</li>
                  <li>âš¡ Real-time sync with configurable intervals</li>
                  <li>ğŸ¨ Seamless integration with Obsidian themes</li>
                  <li>ğŸ“± Full mobile support (iOS/Android)</li>
                </ul>
              </section>

              <footer style="margin-top: 4rem; padding-top: 2rem; border-top: 1px solid var(--muted-border-color); text-align: center; color: var(--muted-color);">
                <p>Built with â¤ï¸ for the Obsidian community</p>
                <p><a href="https://github.com/alexnodeland/obsidian-github-projects/issues">Report an issue</a> |
                   <a href="https://github.com/alexnodeland/obsidian-github-projects/discussions">Join discussions</a></p>
              </footer>
            </div>
          </body>
          </html>
          EOF
          fi

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: _site

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build

    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
